<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <title>🤖 Asistente Escolar UNRC - Modelo de Machine Learning</title>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts - Tipografías profesionales -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Configuración de URLs para desarrollo/producción -->
    <script src="js/config.js"></script>
    
    <!-- Script de prueba de conexión (solo para desarrollo) -->
    <script src="js/test-connection.js"></script>
    
    <script>
        // Si llegas con el historial hacia atrás, forza recarga completa
        window.onpageshow = function (event) {
            if (event.persisted) {
                window.location.reload();
            }
        };
    </script>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            background: radial-gradient(circle at center, #0a0f1f, #000);
            color: #00eaff;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            letter-spacing: 0.01em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: #00ff99;
            text-shadow: 0 0 8px #00ff99, 0 0 15px rgba(0,255,153,0.6);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        /* Contenedor de la mascota estilo Jarvis */
        .jarvis-core {
            width: min(200px, 60vw);
            height: min(200px, 60vw);
            max-width: 200px;
            max-height: 200px;
            border-radius: 50%;
            background: transparent;
            border: 4px solid #00ff99;
            box-shadow: 0 0 30px #00ff99, 0 0 15px #00ff99;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            animation: pulse 2s infinite alternate;
            overflow: hidden;
        }

        .mascota {
            width: 95%;
            height: 95%;
            object-fit: cover;
            border-radius: 50%;
        }

        @keyframes pulse {
            from { transform: scale(1); opacity: 0.9; }
            to { transform: scale(1.03); opacity: 1; }
        }

        /* Animaciones suaves para cuando Alba está hablando */
        @keyframes talking {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.02) rotate(-0.3deg); }
            50% { transform: scale(1.03) rotate(0.3deg); }
            75% { transform: scale(1.02) rotate(-0.2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes talkingBorder {
            0% { 
                border-color: #00ff99; 
                box-shadow: 0 0 25px #00ff99, 0 0 12px #00ff99; 
            }
            33% { 
                border-color: #00eaff; 
                box-shadow: 0 0 28px #00eaff, 0 0 14px #00eaff, 0 0 40px rgba(0,234,255,0.2); 
            }
            66% { 
                border-color: #00ff99; 
                box-shadow: 0 0 30px #00ff99, 0 0 15px #00ff99, 0 0 45px rgba(0,255,153,0.2); 
            }
            100% { 
                border-color: #00ff99; 
                box-shadow: 0 0 25px #00ff99, 0 0 12px #00ff99; 
            }
        }

        @keyframes voiceWaves {
            0% { transform: translateY(0); }
            50% { transform: translateY(-1.5px); }
            100% { transform: translateY(0); }
        }

        @keyframes thinking {
            0% { 
                opacity: 1; 
                transform: scale(1); 
                filter: brightness(1); 
            }
            50% { 
                opacity: 0.85; 
                transform: scale(0.99); 
                filter: brightness(1.1) hue-rotate(10deg); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1); 
                filter: brightness(1); 
            }
        }

        @keyframes celebrate {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-1deg); }
            50% { transform: scale(1.08) rotate(1deg); }
            75% { transform: scale(1.05) rotate(-0.5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes celebrateBorder {
            0% { 
                border-color: #00ff99; 
                box-shadow: 0 0 25px #00ff99; 
            }
            50% { 
                border-color: #ffd700; 
                box-shadow: 0 0 35px #ffd700, 0 0 50px rgba(255,215,0,0.3); 
            }
            100% { 
                border-color: #00ff99; 
                box-shadow: 0 0 25px #00ff99; 
            }
        }

        /* Clases para activar las animaciones suaves */
        .jarvis-core.talking {
            animation: talkingBorder 2s ease-in-out infinite;
        }

        .jarvis-core.talking .mascota {
            animation: talking 1.8s ease-in-out infinite, voiceWaves 1.2s ease-in-out infinite;
        }

        .jarvis-core.listening {
            animation: pulse 2.5s ease-in-out infinite, talkingBorder 4s ease-in-out infinite;
            border-width: 5px;
        }

        .jarvis-core.listening .mascota {
            animation: voiceWaves 1.5s ease-in-out infinite alternate;
        }

        .jarvis-core.thinking {
            animation: pulse 3s ease-in-out infinite;
        }

        .jarvis-core.thinking .mascota {
            animation: thinking 2.5s ease-in-out infinite;
        }

        .jarvis-core.celebrating {
            animation: celebrateBorder 1.2s ease-in-out;
        }

        .jarvis-core.celebrating .mascota {
            animation: celebrate 1.2s ease-in-out;
        }

        /* Interfaz del modelo */
        .model-interface {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
        }

        .input-container {
            background: rgba(0, 234, 255, 0.05);
            border: 1px solid rgba(0, 234, 255, 0.3);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        textarea {
            width: 100%;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(0, 234, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(0.9rem, 3vw, 1rem);
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #00ff99;
            box-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
        }

        textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        button {
            background: #00ff99;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-family: 'Inter', sans-serif;
            font-size: clamp(14px, 4vw, 16px);
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 150px;
            touch-action: manipulation;
            letter-spacing: 0.025em;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover, button:active {
            background: #00cc7a;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 153, 0.4);
        }

        button:disabled {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Estilo especial para el botón de voz */
        .voice-btn {
            background: rgba(0, 234, 255, 0.1) !important;
            color: #00eaff !important;
            border: 2px solid #00eaff !important;
        }

        .voice-btn:hover {
            background: #00eaff !important;
            color: #000 !important;
            box-shadow: 0 0 20px rgba(0, 234, 255, 0.4) !important;
        }

        .clear-btn {
            background: rgba(220, 53, 69, 0.1);
            color: #ff6b6b;
            border: 2px solid #ff6b6b;
        }

        /* ========== ESTILOS PARA LA SECCIÓN DE INFORMACIÓN MEJORADA ========== */
        .model-info-section {
            max-width: 1000px;
            width: 100%;
            margin: 30px auto 40px;
            padding: 0 20px;
        }

        .info-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: rgba(0, 255, 153, 0.05);
            border: 1px solid rgba(0, 255, 153, 0.2);
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff99, transparent);
            transition: left 0.5s ease;
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 255, 153, 0.15);
            border-color: rgba(0, 255, 153, 0.4);
        }

        .info-card:hover::before {
            left: 100%;
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 153, 0.3));
        }

        .info-card h3 {
            color: #00ff99;
            font-size: 1.2rem;
            margin-bottom: 12px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
        }

        .info-card p {
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.6;
            font-size: 0.95rem;
            margin: 0;
        }

        .info-card.main-description {
            border-color: rgba(0, 234, 255, 0.3);
            background: rgba(0, 234, 255, 0.05);
        }

        .info-card.main-description h3 {
            color: #00eaff;
        }

        .info-card.main-description::before {
            background: linear-gradient(90deg, transparent, #00eaff, transparent);
        }

        .info-card.voice-feature {
            border-color: rgba(255, 215, 0, 0.3);
            background: rgba(255, 215, 0, 0.05);
        }

        .info-card.voice-feature h3 {
            color: #ffd700;
        }

        .info-card.voice-feature::before {
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
        }

        /* Estadísticas rápidas */
        .quick-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 234, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(15px);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #00ff99;
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.5);
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 5px;
            text-align: center;
        }

        /* Responsive para la nueva sección */
        @media (max-width: 768px) {
            .model-info-section {
                padding: 0 15px;
            }
            
            .info-cards-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .info-card {
                padding: 20px 15px;
            }
            
            .card-icon {
                font-size: 2rem;
            }
            
            .info-card h3 {
                font-size: 1.1rem;
            }
            
            .quick-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .stat-item {
                flex-direction: row;
                justify-content: space-between;
                min-width: auto;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .info-card {
                padding: 15px 12px;
            }
            
            .card-icon {
                font-size: 1.8rem;
            }
            
            .stat-number {
                font-size: 1.3rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
        }

        .clear-btn:hover {
            background: #ff6b6b;
            color: #000;
        }

        /* Resultados */
        .results-container {
            background: rgba(0, 255, 153, 0.05);
            border: 2px solid rgba(0, 255, 153, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            backdrop-filter: blur(15px);
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            background: rgba(0, 234, 255, 0.1);
            border-left: 4px solid #00eaff;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }

        .result-item.category-result {
            border-left-color: #00ff99;
            background: rgba(0, 255, 153, 0.1);
        }

        .result-item.confidence-result {
            border-left-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .category-badge {
            display: inline-block;
            padding: 8px 16px;
            background: #00ff99;
            color: #000;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 10px;
        }

        .confidence-score {
            font-weight: 700;
            font-size: 1.2rem;
            color: #00ff99;
            text-shadow: 0 0 5px rgba(0, 255, 153, 0.5);
        }

        .confidence-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .confidence-progress {
            height: 100%;
            border-radius: 5px;
            transition: width 1.5s ease-out;
            background: linear-gradient(90deg, #00ff99, #00eaff);
            box-shadow: 0 0 10px rgba(0, 255, 153, 0.5);
        }

        .result-interpretation, .result-advice {
            background: rgba(0, 234, 255, 0.1);
            border-left: 4px solid #00eaff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .result-advice {
            border-left-color: #00ff99;
            background: rgba(0, 255, 153, 0.1);
        }

        /* Quick examples */
        .quick-examples {
            margin-top: 25px;
            text-align: center;
        }

        .example-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .example-btn {
            background: rgba(0, 234, 255, 0.1);
            color: #00eaff;
            border: 1px solid #00eaff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: auto;
            text-transform: none;
        }

        .example-btn:hover {
            background: #00eaff;
            color: #000;
            transform: translateY(-2px);
        }

        /* Error styles */
        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid #ff6b6b;
            color: #ff6b6b;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .main-container {
                padding: 10px;
            }
            
            .jarvis-core {
                width: min(150px, 50vw);
                height: min(150px, 50vw);
            }
            
            .input-container, .results-container {
                padding: 20px 15px;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
            
            .example-buttons {
                flex-direction: column;
            }
        }

        /* Card de detalles técnicos */
        .technical-details-card {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 25px 20px;
            margin: 30px auto;
            max-width: 800px;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .technical-details-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
            transition: left 0.5s ease;
        }

        .technical-details-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .technical-details-card:hover::before {
            left: 100%;
        }

        .technical-details-card .card-icon {
            color: #ffd700;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }

        .technical-details-card h3 {
            color: #ffd700;
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        .technical-details-content {
            text-align: left;
            max-width: 600px;
            margin: 0 auto;
        }

        .tech-item {
            background: rgba(255, 215, 0, 0.05);
            border-left: 3px solid #ffd700;
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }

        .tech-item strong {
            color: #ffd700;
            font-weight: 600;
        }

        .tech-item code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #00eaff;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h1>🤖 Asistente Escolar Alba – Modelo ML</h1>

        <div class="jarvis-core">
            <img src="mascota.jpeg" alt="Mascota Alba" class="mascota">
        </div>

        <!-- Sección de información del modelo -->
        <section class="model-info-section">
            <div class="info-cards-container">
                <div class="info-card main-description">
                    <div class="card-icon">🤖</div>
                    <h3>Inteligencia Artificial Avanzada</h3>
                    <p>Clasificación inteligente de mensajes estudiantiles con recomendaciones personalizadas y análisis de sentimientos.</p>
                </div>
                <div class="info-card">
                    <div class="card-icon">📊</div>
                    <h3>8 Categorías de Análisis</h3>
                    <p>Resultados precisos con categoría y nivel de confianza en tiempo real para matemáticas, física, química, programación y más.</p>
                </div>
                <div class="info-card voice-feature">
                    <div class="card-icon">🎤</div>
                    <h3>Interacción por Voz</h3>
                    <p>Dicta tu comentario y deja que Alba lo analice por ti con síntesis de voz natural en español.</p>
                </div>
            </div>

            <div class="quick-stats">
                <div class="stat-item">
                    <div class="stat-number">531</div>
                    <div class="stat-label">ejemplos entrenados</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">8</div>
                    <div class="stat-label">categorías</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">95%</div>
                    <div class="stat-label">precisión</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">&lt;1s</div>
                    <div class="stat-label">respuesta</div>
                </div>
            </div>
        </section>

        <!-- Interfaz del modelo -->
        <div class="model-interface">
            <div class="input-container">
                <textarea id="chat-input" placeholder="Escribe aquí tu comentario estudiantil o pega texto para analizar con Alba..."></textarea>
                <div class="actions">
                    <button onclick="analyzeText()" id="analyze-btn">
                        <i class="fas fa-brain"></i>
                        Analizar con IA
                    </button>
                    <button onclick="startVoice()" class="voice-btn" id="voice-btn">
                        <i class="fas fa-microphone"></i>
                        Habla con Alba
                    </button>
                    <button onclick="clearText()" class="clear-btn">
                        <i class="fas fa-eraser"></i>
                        Limpiar
                    </button>
                </div>

                <!-- Ejemplos rápidos -->
                <div class="quick-examples">
                    <p>💡 Prueba ejemplos rápidos:</p>
                    <div class="example-buttons">
                        <button class="example-btn" onclick="setExample('Tengo dudas y me siento desmotivado para seguir cursando.')">😔 Deserción</button>
                        <button class="example-btn" onclick="setExample('Estoy muy contento con mi rendimiento en la materia.')">😊 Positivo</button>
                        <button class="example-btn" onclick="setExample('Necesito motivación para preparar el final.')">💪 Motivación</button>
                        <button class="example-btn" onclick="setExample('No entiendo un problema de programación en Python.')">💻 Programación</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenedor de resultados -->
        <div id="results-container" style="display: none; margin-top: 30px; max-width: 800px; margin-left: auto; margin-right: auto;">
            <div style="background: linear-gradient(135deg, rgba(0,255,153,0.1), rgba(0,234,255,0.08)); border: 2px solid rgba(0,255,153,0.3); border-radius: 20px; padding: 30px; backdrop-filter: blur(15px); box-shadow: 0 10px 30px rgba(0,255,153,0.2);">

                <!-- Título de resultados -->
                <div style="text-align: center; margin-bottom: 25px;">
                    <h2 style="color: #00ff99; font-size: 1.5rem; margin: 0; font-weight: 600;">🎯 Resultados del Análisis</h2>
                    <div style="width: 60px; height: 3px; background: linear-gradient(90deg, #00ff99, #00eaff); margin: 10px auto 0; border-radius: 2px;"></div>
                </div>

                <!-- Categoría detectada -->
                <div style="background: rgba(0,234,255,0.1); border: 1px solid rgba(0,234,255,0.3); border-radius: 15px; padding: 20px; margin: 15px 0; display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 2rem;">✅</div>
                    <div style="flex: 1;">
                        <div style="color: #00eaff; font-weight: 600; font-size: 0.9rem; margin-bottom: 5px;">CATEGORÍA DETECTADA</div>
                        <div style="color: #ffffff; font-size: 1.2rem; font-weight: 700; text-transform: uppercase;" id="result-category">—</div>
                    </div>
                </div>

                <!-- Nivel de confianza -->
                <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 15px; padding: 20px; margin: 15px 0;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2rem;">📊</div>
                        <div style="flex: 1;">
                            <div style="color: #ffd700; font-weight: 600; font-size: 0.9rem; margin-bottom: 5px;">NIVEL DE CONFIANZA</div>
                            <div style="color: #ffffff; font-size: 1.4rem; font-weight: 700;" id="result-confidence">—</div>
                        </div>
                    </div>
                    <div style="width: 100%; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);">
                        <div style="height: 100%; border-radius: 6px; background: linear-gradient(90deg, #00ff99, #00eaff, #ffd700); transition: width 1.5s ease-out; box-shadow: 0 0 10px rgba(0,255,153,0.5);" id="confidence-progress"></div>
                    </div>
                </div>

                <!-- Interpretación -->
                <div style="background: rgba(0,255,153,0.1); border: 1px solid rgba(0,255,153,0.3); border-radius: 15px; padding: 20px; margin: 15px 0;">
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="font-size: 2rem;">🧠</div>
                        <div style="flex: 1;">
                            <div style="color: #00ff99; font-weight: 600; font-size: 0.9rem; margin-bottom: 10px;">INTERPRETACIÓN</div>
                            <div style="color: rgba(255,255,255,0.9); line-height: 1.6; font-size: 1rem;" id="result-interpretation">—</div>
                        </div>
                    </div>
                </div>

                <!-- Recomendación -->
                <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 15px; padding: 20px; margin: 15px 0;">
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="font-size: 2rem;">💡</div>
                        <div style="flex: 1;">
                            <div style="color: #ffd700; font-weight: 600; font-size: 0.9rem; margin-bottom: 10px;">RECOMENDACIÓN</div>
                            <div style="color: rgba(255,255,255,0.9); line-height: 1.6; font-size: 1rem;" id="result-advice">—</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Detalles técnicos del modelo -->
        <div style="margin-top: 40px; max-width: 700px; text-align: left; background: rgba(0,255,153,0.05); padding: 25px; border-radius: 15px; border: 1px solid rgba(0,255,153,0.2);">
            <h3 style="color: #00ff99; text-align: center; margin-bottom: 20px;">⚙️ Detalles Técnicos del Modelo</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                <div>
                    <strong style="color: #00eaff;">🧠 Algoritmo:</strong> Regresión Logística + CountVectorizer
                </div>
                <div>
                    <strong style="color: #00eaff;">📊 Datos:</strong> 531 ejemplos de entrenamiento
                </div>
                <div>
                    <strong style="color: #00eaff;">🎯 Categorías:</strong> 8 tipos de análisis
                </div>
                <div>
                    <strong style="color: #00eaff;">⚡ API:</strong> Flask con respuestas en tiempo real
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer style="margin-top: 40px; color: rgba(255,255,255,0.6); font-size: 0.9rem; text-align: center;">
            Universidad Rosario Castellanos © 2025
        </footer>
    </div>

    <script>
        // Configuración de la API
        const API_BASE_URL = 'http://localhost:5000';

        // Variables globales para voz
        let vozGoogleEspanol = null;
        let recognition = null;
        let isListening = false;

        // Cargar voces disponibles
        function cargarVozGoogle() {
            const voces = speechSynthesis.getVoices();
            
            // Prioridad: Google Español US femenina
            vozGoogleEspanol = voces.find(voz => 
                voz.name.includes('Google') && 
                voz.lang === 'es-US' &&
                voz.name.toLowerCase().includes('female')
            );
            
            if (!vozGoogleEspanol) {
                vozGoogleEspanol = voces.find(voz => 
                    voz.name.includes('Google') && 
                    voz.lang === 'es-US'
                );
            }
            
            if (!vozGoogleEspanol) {
                vozGoogleEspanol = voces.find(voz => 
                    voz.lang.startsWith('es')
                );
            }
            
            console.log('Voz seleccionada:', vozGoogleEspanol ? vozGoogleEspanol.name : 'Sistema');
        }

        // Inicializar reconocimiento de voz
        function initVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                console.warn('Reconocimiento de voz no soportado');
                return false;
            }
            
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-US';
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            recognition.onstart = () => {
                isListening = true;
                updateVoiceButton('listening');
                showNotification('Escuchando...', 'info');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chat-input').value = transcript;
                analyzeText();
            };
            
            recognition.onerror = (event) => {
                console.error('Error en reconocimiento:', event.error);
                showNotification('Error en reconocimiento de voz', 'error');
                updateVoiceButton('idle');
            };
            
            recognition.onend = () => {
                isListening = false;
                updateVoiceButton('idle');
            };
            
            return true;
        }

        // Función para hablar
        function speak(text) {
            if (!vozGoogleEspanol && speechSynthesis.getVoices().length > 0) {
                cargarVozGoogle();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-US';
            
            if (vozGoogleEspanol) {
                utterance.voice = vozGoogleEspanol;
            }
            
            utterance.rate = 1.0;
            utterance.pitch = 1.1;
            utterance.volume = 1.0;
            
            utterance.onstart = () => updateJarvisAnimation('talking');
            utterance.onend = () => updateJarvisAnimation('idle');
            
            speechSynthesis.speak(utterance);
        }

        // Actualizar animación de Jarvis
        function updateJarvisAnimation(state) {
            const jarvis = document.querySelector('.jarvis-core');
            jarvis.classList.remove('talking', 'listening', 'thinking', 'celebrating');
            
            if (state !== 'idle') {
                jarvis.classList.add(state);
            }
        }

        // Actualizar botón de voz
        function updateVoiceButton(state) {
            const btn = document.getElementById('voice-btn');
            const icon = btn.querySelector('i');
            
            if (state === 'listening') {
                btn.innerHTML = '<i class="fas fa-stop"></i> Detener';
                btn.classList.add('listening');
            } else {
                btn.innerHTML = '<i class="fas fa-microphone"></i> Habla con Alba';
                btn.classList.remove('listening');
            }
        }

        // Iniciar/detener voz
        function startVoice() {
            if (isListening) {
                recognition.stop();
                return;
            }
            
            if (!recognition && !initVoiceRecognition()) {
                showNotification('Tu navegador no soporta reconocimiento de voz', 'error');
                return;
            }
            
            try {
                recognition.start();
            } catch (error) {
                console.error('Error al iniciar reconocimiento:', error);
                showNotification('Error al iniciar reconocimiento de voz', 'error');
            }
        }

        // Analizar texto
        async function analyzeText() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            if (!text) {
                showNotification('Por favor escribe algo para analizar', 'warning');
                input.focus();
                return;
            }
            
            // Deshabilitar botón mientras procesa
            const btn = document.getElementById('analyze-btn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analizando...';
            
            updateJarvisAnimation('thinking');
            
            try {
                const response = await fetch(`${API_BASE_URL}/clasificar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ texto: text })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                displayResults(data);
                
                // Reproducir respuesta si hay contenido
                const responseText = `${data.respuesta || ''}. ${data.consejo || ''}`.trim();
                if (responseText) {
                    setTimeout(() => speak(responseText), 500);
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError('No se pudo conectar con el modelo de IA');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
                updateJarvisAnimation('idle');
            }
        }

        // Mostrar resultados
        function displayResults(data) {
            document.getElementById('result-category').textContent = data.categoria || 'Desconocida';
            document.getElementById('result-interpretation').textContent = data.respuesta || 'Sin interpretación';
            document.getElementById('result-advice').textContent = data.consejo || 'Sin recomendación';
            
            const confidence = typeof data.confianza === 'number' ? data.confianza : 0;
            const confidencePercent = Math.round(confidence * 100);
            
            document.getElementById('result-confidence').textContent = `${confidencePercent}%`;
            document.getElementById('confidence-progress').style.width = `${confidencePercent}%`;
            
            document.getElementById('results-container').style.display = 'block';
            updateJarvisAnimation('celebrating');
            
            // Scroll suave a resultados
            setTimeout(() => {
                document.getElementById('results-container').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }, 300);
        }

        // Mostrar error
        function showError(message) {
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = `
                <div class="error-message">
                    <div class="error-icon">⚠️</div>
                    <h3>Error de Conexión</h3>
                    <p>${message}</p>
                    <button onclick="testConnection()" style="margin-top: 15px;">Reintentar Conexión</button>
                </div>
            `;
            resultsContainer.style.display = 'block';
            updateJarvisAnimation('idle');
        }

        // Limpiar texto
        function clearText() {
            document.getElementById('chat-input').value = '';
            document.getElementById('results-container').style.display = 'none';
            updateJarvisAnimation('idle');
        }

        // Establecer ejemplo
        function setExample(text) {
            document.getElementById('chat-input').value = text;
            document.getElementById('chat-input').focus();
        }

        // Mostrar notificación
        function showNotification(message, type = 'info') {
            // Crear notificación temporal
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#ff6b6b' : type === 'warning' ? '#ffd700' : '#00ff99'};
                color: ${type === 'error' ? '#fff' : '#000'};
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 500;
                animation: slideInRight 0.3s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Probar conexión
        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/clasificar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ texto: 'test' })
                });
                
                if (response.ok) {
                    showNotification('Conexión exitosa con el modelo', 'success');
                } else {
                    throw new Error();
                }
            } catch (error) {
                showNotification('No se puede conectar al servidor', 'error');
            }
        }

        // Animaciones CSS para notificaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Inicialización
        speechSynthesis.onvoiceschanged = cargarVozGoogle;
        if (speechSynthesis.getVoices().length > 0) {
            cargarVozGoogle();
        }
        
        initVoiceRecognition();
        
        // Atajos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzeText();
            } else if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                clearText();
            }
        });
    </script>
</body>
</html>
